{"ast":null,"code":"import { supportsLocalStorage } from './helpers';\n/**\n * @experimental\n */\n\nexport const internals = {\n  /**\n   * @experimental\n   */\n  debug: !!(globalThis && supportsLocalStorage() && globalThis.localStorage && globalThis.localStorage.getItem('supabase.gotrue-js.locks.debug') === 'true')\n};\n/**\n * An error thrown when a lock cannot be acquired after some amount of time.\n *\n * Use the {@link #isAcquireTimeout} property instead of checking with `instanceof`.\n */\n\nexport class LockAcquireTimeoutError extends Error {\n  constructor(message) {\n    super(message);\n    this.isAcquireTimeout = true;\n  }\n\n}\nexport class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError {}\n/**\n * Implements a global exclusive lock using the Navigator LockManager API. It\n * is available on all browsers released after 2022-03-15 with Safari being the\n * last one to release support. If the API is not available, this function will\n * throw. Make sure you check availablility before configuring {@link\n * GoTrueClient}.\n *\n * You can turn on debugging by setting the `supabase.gotrue-js.locks.debug`\n * local storage item to `true`.\n *\n * Internals:\n *\n * Since the LockManager API does not preserve stack traces for the async\n * function passed in the `request` method, a trick is used where acquiring the\n * lock releases a previously started promise to run the operation in the `fn`\n * function. The lock waits for that promise to finish (with or without error),\n * while the function will finally wait for the result anyway.\n *\n * @param name Name of the lock to be acquired.\n * @param acquireTimeout If negative, no timeout. If 0 an error is thrown if\n *                       the lock can't be acquired without waiting. If positive, the lock acquire\n *                       will time out after so many milliseconds. An error is\n *                       a timeout if it has `isAcquireTimeout` set to true.\n * @param fn The operation to run once the lock is acquired.\n */\n\nexport async function navigatorLock(name, acquireTimeout, fn) {\n  if (internals.debug) {\n    console.log('@supabase/gotrue-js: navigatorLock: acquire lock', name, acquireTimeout);\n  }\n\n  const abortController = new globalThis.AbortController();\n\n  if (acquireTimeout > 0) {\n    setTimeout(() => {\n      abortController.abort();\n\n      if (internals.debug) {\n        console.log('@supabase/gotrue-js: navigatorLock acquire timed out', name);\n      }\n    }, acquireTimeout);\n  } // MDN article: https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request\n\n\n  return await globalThis.navigator.locks.request(name, acquireTimeout === 0 ? {\n    mode: 'exclusive',\n    ifAvailable: true\n  } : {\n    mode: 'exclusive',\n    signal: abortController.signal\n  }, async lock => {\n    if (lock) {\n      if (internals.debug) {\n        console.log('@supabase/gotrue-js: navigatorLock: acquired', name, lock.name);\n      }\n\n      try {\n        return await fn();\n      } finally {\n        if (internals.debug) {\n          console.log('@supabase/gotrue-js: navigatorLock: released', name, lock.name);\n        }\n      }\n    } else {\n      if (acquireTimeout === 0) {\n        if (internals.debug) {\n          console.log('@supabase/gotrue-js: navigatorLock: not immediately available', name);\n        }\n\n        throw new NavigatorLockAcquireTimeoutError(`Acquiring an exclusive Navigator LockManager lock \"${name}\" immediately failed`);\n      } else {\n        if (internals.debug) {\n          try {\n            const result = await globalThis.navigator.locks.query();\n            console.log('@supabase/gotrue-js: Navigator LockManager state', JSON.stringify(result, null, '  '));\n          } catch (e) {\n            console.warn('@supabase/gotrue-js: Error when querying Navigator LockManager state', e);\n          }\n        } // Browser is not following the Navigator LockManager spec, it\n        // returned a null lock when we didn't use ifAvailable. So we can\n        // pretend the lock is acquired in the name of backward compatibility\n        // and user experience and just run the function.\n\n\n        console.warn('@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request');\n        return await fn();\n      }\n    }\n  });\n}","map":{"version":3,"mappings":"AAAA,SAASA,oBAAT,QAAqC,WAArC;AAEA;;;;AAGA,OAAO,MAAMC,SAAS,GAAG;EACvB;;;EAGAC,KAAK,EAAE,CAAC,EACNC,UAAU,IACVH,oBAAoB,EADpB,IAEAG,UAAU,CAACC,YAFX,IAGAD,UAAU,CAACC,YAAX,CAAwBC,OAAxB,CAAgC,gCAAhC,MAAsE,MAJhE;AAJe,CAAlB;AAYP;;;;;;AAKA,OAAM,MAAgBC,uBAAhB,SAAgDC,KAAhD,CAAqD;EAGzDC,YAAYC,OAAZ,EAA2B;IACzB,MAAMA,OAAN;IAHc,wBAAmB,IAAnB;EAIf;;AALwD;AAQ3D,OAAM,MAAOC,gCAAP,SAAgDJ,uBAAhD,CAAuE;AAE7E;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBA,OAAO,eAAeK,aAAf,CACLC,IADK,EAELC,cAFK,EAGLC,EAHK,EAGe;EAEpB,IAAIb,SAAS,CAACC,KAAd,EAAqB;IACnBa,OAAO,CAACC,GAAR,CAAY,kDAAZ,EAAgEJ,IAAhE,EAAsEC,cAAtE;EACD;;EAED,MAAMI,eAAe,GAAG,IAAId,UAAU,CAACe,eAAf,EAAxB;;EAEA,IAAIL,cAAc,GAAG,CAArB,EAAwB;IACtBM,UAAU,CAAC,MAAK;MACdF,eAAe,CAACG,KAAhB;;MACA,IAAInB,SAAS,CAACC,KAAd,EAAqB;QACnBa,OAAO,CAACC,GAAR,CAAY,sDAAZ,EAAoEJ,IAApE;MACD;IACF,CALS,EAKPC,cALO,CAAV;EAMD,CAfmB,CAiBpB;;;EAEA,OAAO,MAAMV,UAAU,CAACkB,SAAX,CAAqBC,KAArB,CAA2BC,OAA3B,CACXX,IADW,EAEXC,cAAc,KAAK,CAAnB,GACI;IACEW,IAAI,EAAE,WADR;IAEEC,WAAW,EAAE;EAFf,CADJ,GAKI;IACED,IAAI,EAAE,WADR;IAEEE,MAAM,EAAET,eAAe,CAACS;EAF1B,CAPO,EAWX,MAAOC,IAAP,IAAe;IACb,IAAIA,IAAJ,EAAU;MACR,IAAI1B,SAAS,CAACC,KAAd,EAAqB;QACnBa,OAAO,CAACC,GAAR,CAAY,8CAAZ,EAA4DJ,IAA5D,EAAkEe,IAAI,CAACf,IAAvE;MACD;;MAED,IAAI;QACF,OAAO,MAAME,EAAE,EAAf;MACD,CAFD,SAEU;QACR,IAAIb,SAAS,CAACC,KAAd,EAAqB;UACnBa,OAAO,CAACC,GAAR,CAAY,8CAAZ,EAA4DJ,IAA5D,EAAkEe,IAAI,CAACf,IAAvE;QACD;MACF;IACF,CAZD,MAYO;MACL,IAAIC,cAAc,KAAK,CAAvB,EAA0B;QACxB,IAAIZ,SAAS,CAACC,KAAd,EAAqB;UACnBa,OAAO,CAACC,GAAR,CAAY,+DAAZ,EAA6EJ,IAA7E;QACD;;QAED,MAAM,IAAIF,gCAAJ,CACJ,sDAAsDE,IAAI,sBADtD,CAAN;MAGD,CARD,MAQO;QACL,IAAIX,SAAS,CAACC,KAAd,EAAqB;UACnB,IAAI;YACF,MAAM0B,MAAM,GAAG,MAAMzB,UAAU,CAACkB,SAAX,CAAqBC,KAArB,CAA2BO,KAA3B,EAArB;YAEAd,OAAO,CAACC,GAAR,CACE,kDADF,EAEEc,IAAI,CAACC,SAAL,CAAeH,MAAf,EAAuB,IAAvB,EAA6B,IAA7B,CAFF;UAID,CAPD,CAOE,OAAOI,CAAP,EAAe;YACfjB,OAAO,CAACkB,IAAR,CACE,sEADF,EAEED,CAFF;UAID;QACF,CAfI,CAiBL;QACA;QACA;QACA;;;QACAjB,OAAO,CAACkB,IAAR,CACE,yPADF;QAIA,OAAO,MAAMnB,EAAE,EAAf;MACD;IACF;EACF,CA7DU,CAAb;AA+DD","names":["supportsLocalStorage","internals","debug","globalThis","localStorage","getItem","LockAcquireTimeoutError","Error","constructor","message","NavigatorLockAcquireTimeoutError","navigatorLock","name","acquireTimeout","fn","console","log","abortController","AbortController","setTimeout","abort","navigator","locks","request","mode","ifAvailable","signal","lock","result","query","JSON","stringify","e","warn"],"sources":["C:\\Users\\unaiz\\Desktop\\codepath_tf\\web102\\activity\\lab\\web102_unit7lab\\client\\node_modules\\@supabase\\auth-js\\src\\lib\\locks.ts"],"sourcesContent":["import { supportsLocalStorage } from './helpers'\n\n/**\n * @experimental\n */\nexport const internals = {\n  /**\n   * @experimental\n   */\n  debug: !!(\n    globalThis &&\n    supportsLocalStorage() &&\n    globalThis.localStorage &&\n    globalThis.localStorage.getItem('supabase.gotrue-js.locks.debug') === 'true'\n  ),\n}\n\n/**\n * An error thrown when a lock cannot be acquired after some amount of time.\n *\n * Use the {@link #isAcquireTimeout} property instead of checking with `instanceof`.\n */\nexport abstract class LockAcquireTimeoutError extends Error {\n  public readonly isAcquireTimeout = true\n\n  constructor(message: string) {\n    super(message)\n  }\n}\n\nexport class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError {}\n\n/**\n * Implements a global exclusive lock using the Navigator LockManager API. It\n * is available on all browsers released after 2022-03-15 with Safari being the\n * last one to release support. If the API is not available, this function will\n * throw. Make sure you check availablility before configuring {@link\n * GoTrueClient}.\n *\n * You can turn on debugging by setting the `supabase.gotrue-js.locks.debug`\n * local storage item to `true`.\n *\n * Internals:\n *\n * Since the LockManager API does not preserve stack traces for the async\n * function passed in the `request` method, a trick is used where acquiring the\n * lock releases a previously started promise to run the operation in the `fn`\n * function. The lock waits for that promise to finish (with or without error),\n * while the function will finally wait for the result anyway.\n *\n * @param name Name of the lock to be acquired.\n * @param acquireTimeout If negative, no timeout. If 0 an error is thrown if\n *                       the lock can't be acquired without waiting. If positive, the lock acquire\n *                       will time out after so many milliseconds. An error is\n *                       a timeout if it has `isAcquireTimeout` set to true.\n * @param fn The operation to run once the lock is acquired.\n */\nexport async function navigatorLock<R>(\n  name: string,\n  acquireTimeout: number,\n  fn: () => Promise<R>\n): Promise<R> {\n  if (internals.debug) {\n    console.log('@supabase/gotrue-js: navigatorLock: acquire lock', name, acquireTimeout)\n  }\n\n  const abortController = new globalThis.AbortController()\n\n  if (acquireTimeout > 0) {\n    setTimeout(() => {\n      abortController.abort()\n      if (internals.debug) {\n        console.log('@supabase/gotrue-js: navigatorLock acquire timed out', name)\n      }\n    }, acquireTimeout)\n  }\n\n  // MDN article: https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request\n\n  return await globalThis.navigator.locks.request(\n    name,\n    acquireTimeout === 0\n      ? {\n          mode: 'exclusive',\n          ifAvailable: true,\n        }\n      : {\n          mode: 'exclusive',\n          signal: abortController.signal,\n        },\n    async (lock) => {\n      if (lock) {\n        if (internals.debug) {\n          console.log('@supabase/gotrue-js: navigatorLock: acquired', name, lock.name)\n        }\n\n        try {\n          return await fn()\n        } finally {\n          if (internals.debug) {\n            console.log('@supabase/gotrue-js: navigatorLock: released', name, lock.name)\n          }\n        }\n      } else {\n        if (acquireTimeout === 0) {\n          if (internals.debug) {\n            console.log('@supabase/gotrue-js: navigatorLock: not immediately available', name)\n          }\n\n          throw new NavigatorLockAcquireTimeoutError(\n            `Acquiring an exclusive Navigator LockManager lock \"${name}\" immediately failed`\n          )\n        } else {\n          if (internals.debug) {\n            try {\n              const result = await globalThis.navigator.locks.query()\n\n              console.log(\n                '@supabase/gotrue-js: Navigator LockManager state',\n                JSON.stringify(result, null, '  ')\n              )\n            } catch (e: any) {\n              console.warn(\n                '@supabase/gotrue-js: Error when querying Navigator LockManager state',\n                e\n              )\n            }\n          }\n\n          // Browser is not following the Navigator LockManager spec, it\n          // returned a null lock when we didn't use ifAvailable. So we can\n          // pretend the lock is acquired in the name of backward compatibility\n          // and user experience and just run the function.\n          console.warn(\n            '@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request'\n          )\n\n          return await fn()\n        }\n      }\n    }\n  )\n}\n"]},"metadata":{},"sourceType":"module"}